<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Block Man</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #87CEEB;
        }
        canvas {
            background: url('https://www.transparenttextures.com/patterns/forest-floor.png') repeat;
            border: 1px solid black;
        }
        #score {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 20px;
            font-family: Arial, sans-serif;
        }
    </style>
</head>
<body>
    <div id="score">Score: 0</div>
    <canvas id="gameCanvas" width="800" height="400"></canvas>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");

        const motorbike = {
            x: canvas.width / 2 - 25,
            y: canvas.height - 60,
            width: 50,
            height: 30,
            speed: 5,
            dx: 0,
            dy: 0,
            isSuper: false
        };

        let score = 0;
        let blueCoin = null;
        let blueCoinActive = false;
        let blueCoinTimeout;
        const coins = [
            { x: 200, y: 100, radius: 5, collected: false },
            { x: 400, y: 150, radius: 5, collected: false },
            { x: 600, y: 200, radius: 5, collected: false }
        ];

        const obstacles = [
            { x: 100, y: 100, width: 30, height: 30, speedX: 2, speedY: 1, active: true },
            { x: 500, y: 200, width: 40, height: 40, speedX: -1, speedY: 2, active: true }
        ];

        function drawMotorbike() {
            ctx.fillStyle = "blue";
            ctx.fillRect(motorbike.x, motorbike.y, motorbike.width, motorbike.height);
        }

        function drawCoins() {
            ctx.fillStyle = "gold";
            coins.forEach(coin => {
                if (!coin.collected) {
                    ctx.beginPath();
                    ctx.arc(coin.x, coin.y, coin.radius, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.closePath();
                }
            });
        }

        function drawObstacles() {
            ctx.fillStyle = "red";
            obstacles.forEach(obstacle => {
                if (obstacle.active) {
                    ctx.fillRect(obstacle.x, obstacle.y, obstacle.width, obstacle.height);
                }
            });
        }

        function drawBlueCoin() {
            if (blueCoin) {
                ctx.fillStyle = "darkblue";
                ctx.beginPath();
                ctx.arc(blueCoin.x, blueCoin.y, blueCoin.radius, 0, Math.PI * 2);
                ctx.fill();
                ctx.closePath();
            }
        }

        function clearCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        function newPos() {
            motorbike.x += motorbike.dx;
            motorbike.y += motorbike.dy;

            if (motorbike.x < 0) {
                motorbike.x = 0;
            }
            if (motorbike.x + motorbike.width > canvas.width) {
                motorbike.x = canvas.width - motorbike.width;
            }
            if (motorbike.y < 0) {
                motorbike.y = 0;
            }
            if (motorbike.y + motorbike.height > canvas.height) {
                motorbike.y = canvas.height - motorbike.height;
            }
        }

        function moveRight() {
            motorbike.dx = motorbike.speed;
        }

        function moveLeft() {
            motorbike.dx = -motorbike.speed;
        }

        function moveUp() {
            motorbike.dy = -motorbike.speed;
        }

        function moveDown() {
            motorbike.dy = motorbike.speed;
        }

        function keyDown(e) {
            if (e.key === 'ArrowRight') {
                moveRight();
            } else if (e.key === 'ArrowLeft') {
                moveLeft();
            } else if (e.key === 'ArrowUp') {
                moveUp();
            } else if (e.key === 'ArrowDown') {
                moveDown();
            }
        }

        function keyUp(e) {
            if (
                e.key === 'ArrowRight' ||
                e.key === 'ArrowLeft' ||
                e.key === 'ArrowUp' ||
                e.key === 'ArrowDown'
            ) {
                motorbike.dx = 0;
                motorbike.dy = 0;
            }
        }

        function checkCollision() {
            obstacles.forEach(obstacle => {
                if (
                    motorbike.x < obstacle.x + obstacle.width &&
                    motorbike.x + motorbike.width > obstacle.x &&
                    motorbike.y < obstacle.y + obstacle.height &&
                    motorbike.y + motorbike.height > obstacle.y &&
                    obstacle.active
                ) {
                    if (motorbike.isSuper) {
                        obstacle.active = false;
                        score += 5;
                        document.getElementById("score").innerText = `Score: ${score}`;
                        setTimeout(() => {
                            obstacle.x = Math.random() * (canvas.width - obstacle.width);
                            obstacle.y = Math.random() * (canvas.height - obstacle.height);
                            obstacle.active = true;
                        }, 5000);
                    } else {
                        gameOver();
                    }
                }
            });
        }

        function collectCoin() {
            coins.forEach(coin => {
                if (
                    motorbike.x < coin.x + coin.radius &&
                    motorbike.x + motorbike.width > coin.x - coin.radius &&
                    motorbike.y < coin.y + coin.radius &&
                    motorbike.y + motorbike.height > coin.y - coin.radius &&
                    !coin.collected
                ) {
                    coin.collected = true;
                    score++;
                    document.getElementById("score").innerText = `Score: ${score}`;
                    const newX = Math.random() * canvas.width;
                    const newY = Math.random() * canvas.height;
                    coins.push({
                        x: newX,
                        y: newY,
                        radius: 5,
                        collected: false
                    });
                }
            });

            if (blueCoin && !blueCoinActive && motorbike.x < blueCoin.x + blueCoin.radius &&
                motorbike.x + motorbike.width > blueCoin.x - blueCoin.radius &&
                motorbike.y < blueCoin.y + blueCoin.radius &&
                motorbike.y + motorbike.height > blueCoin.y - blueCoin.radius) {
                blueCoinActive = true;
                motorbike.isSuper = true;
                motorbike.width *= 1.5
                ;
                motorbike.height *= 1.5;
                clearTimeout(blueCoinTimeout); // Stoppe den Timer für das Verschwinden
                blueCoin = null; // Setze die blaue Münze zurück
                blueCoinTimeout = setTimeout(() => {
                    blueCoinActive = false; // Setze den Status der blauen Münze zurück
                    motorbike.isSuper = false; // Setze den Superstatus des Motorrades zurück
                    motorbike.width /= 1.5; // Setze die Größe des Motorrades zurück
                    motorbike.height /= 1.5;
                    generateBlueCoin(); // Generiere eine neue blaue Münze
                }, 45000);
            }
        }

        function updateObstacles() {
            obstacles.forEach(obstacle => {
                if (obstacle.active) {
                    obstacle.x += obstacle.speedX;
                    obstacle.y += obstacle.speedY;

                    if (obstacle.x <= 0 || obstacle.x + obstacle.width >= canvas.width) {
                        obstacle.speedX *= -1;
                    }
                    if (obstacle.y <= 0 || obstacle.y + obstacle.height >= canvas.height) {
                        obstacle.speedY *= -1;
                    }
                }
            });
        }

        function generateBlueCoin() {
            if (!blueCoin) {
                const x = Math.random() * (canvas.width - 20) + 10;
                const y = Math.random() * (canvas.height - 20) + 10;
                blueCoin = { x, y, radius: 10 };
            }
        }

        function scheduleBlueCoin() {
            blueCoinTimeout = setTimeout(() => {
                generateBlueCoin();
                blueCoinActive = false;
            }, 45000);
        }

        function updateCanvas() {
            clearCanvas();
            drawMotorbike();
            drawCoins();
            drawObstacles();
            drawBlueCoin();
            newPos();
            checkCollision();
            collectCoin();
            updateObstacles();
            requestAnimationFrame(updateCanvas);
        }

        document.addEventListener('keydown', keyDown);
        document.addEventListener('keyup', keyUp);

        scheduleBlueCoin();
        updateCanvas();
    </script>
</body>
</html>
